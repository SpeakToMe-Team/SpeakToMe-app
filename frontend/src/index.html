<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Smart Speech Assistant</title>
  
  <link href="https://fonts.googleapis.com/css?family=Covered+By+Your+Grace|Reenie+Beanie" rel="stylesheet">
  <link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
    crossorigin="anonymous">

  <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
    crossorigin="anonymous"></script>
  <script src="https://use.fontawesome.com/5bfddbc387.js"></script>

  <!-- The SDK has a dependency on requirejs (http://requirejs.org/). -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.3/require.min.js"></script>
  <script>
    // Special handling to let the sample work when loaded directly from file system.
    if (window.location.protocol == "file:") {
      document.write('\<script src="http://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.3/require.min.js">\<\/script>');
    }
  </script>

  <!-- SDK REFERENCE -->
  <script src="static/SpeechToText/speech.browser.sdk-min.js"></script>

  <!-- SDK USAGE -->
  <script>
    // On doument load resolve the SDK dependecy
    function Initialize(onComplete) {
      require(["Speech.Browser.Sdk"], function (SDK) {
        onComplete(SDK);
      });
    }

    // Setup the recongizer
    function RecognizerSetup(SDK, recognitionMode, language, format, subscriptionKey) {
      var recognizerConfig = new SDK.RecognizerConfig(
        new SDK.SpeechConfig(
          new SDK.Context(
            new SDK.OS(navigator.userAgent, "Browser", null),
            new SDK.Device("SpeechSample", "SpeechSample", "1.0.00000"))),
        recognitionMode, // SDK.RecognitionMode.Interactive  (Options - Interactive/Conversation/Dictation>)
        language, // Supported laguages are specific to each recognition mode. Refer to docs.
        format); // SDK.SpeechResultFormat.Simple (Options - Simple/Detailed)

      // Alternatively use SDK.CognitiveTokenAuthentication(fetchCallback, fetchOnExpiryCallback) for token auth
      var authentication = new SDK.CognitiveSubscriptionKeyAuthentication(subscriptionKey);

      return SDK.CreateRecognizer(recognizerConfig, authentication);
    }

    // Start the recognition
    function RecognizerStart(SDK, recognizer) {
      recognizer.Recognize((event) => {
        /*
         Alternative syntax for typescript devs.
         if (event instanceof SDK.RecognitionTriggeredEvent)
        */
        switch (event.Name) {
          case "RecognitionTriggeredEvent":
            UpdateStatus("Initializing");
            break;
          case "ListeningStartedEvent":
            UpdateStatus("Listening");
            break;
          case "RecognitionStartedEvent":
            UpdateStatus("Listening_Recognizing");
            break;
          case "SpeechStartDetectedEvent":
            UpdateStatus("Listening_DetectedSpeech_Recognizing");
            console.log(JSON.stringify(event.Result)); // check console for other information in result
            break;
          case "SpeechHypothesisEvent":
            UpdateRecognizedHypothesis(event.Result.Text);
            console.log(JSON.stringify(event.Result)); // check console for other information in result
            break;
          case "SpeechEndDetectedEvent":
            OnSpeechEndDetected();
            UpdateStatus("Processing_Adding_Final_Touches");
            console.log(JSON.stringify(event.Result)); // check console for other information in result
            break;
          case "SpeechSimplePhraseEvent":
            UpdateRecognizedPhrase(JSON.stringify(event.Result, null, 3));
            break;
          case "SpeechDetailedPhraseEvent":
            UpdateRecognizedPhrase(JSON.stringify(event.Result, null, 3));
            break;
          case "RecognitionEndedEvent":
            OnComplete();
            UpdateStatus("Idle");
            console.log(JSON.stringify(event)); // Debug information
            break;
        }
      })
        .On(() => {
          // The request succeeded. Nothing to do here.
        },
        (error) => {
          console.error(error);
        });
    }

    // Stop the Recognition.
    function RecognizerStop(SDK, recognizer) {
      // recognizer.AudioSource.Detach(audioNodeId) can be also used here. (audioNodeId is part of ListeningStartedEvent)
      recognizer.AudioSource.TurnOff();
    }
  </script>

  <!-- Browser Hooks -->
  <script>
    var startBtn, stopBtn, hypothesisDiv, phraseDiv, statusDiv, key, languageOptions, formatOptions;
    var SDK;
    var recognizer;
    var previousSubscriptionKey;

    Initialize(function (speechSdk) {
      SDK = speechSdk;
      startBtn.disabled = false;
    });


    function Setup() {
      //recognizer = RecognizerSetup(SDK, SDK.RecognitionMode.Interactive, languageOptions.value, SDK.SpeechResultFormat[formatOptions.value], key.value);
      recognizer = RecognizerSetup(SDK, SDK.RecognitionMode.Conversation, languageOptions, SDK.SpeechResultFormat[formatOptions], key);
    }

    function UpdateStatus(status) {
      statusDiv.innerHTML = status;
    }

    function UpdateRecognizedHypothesis(text) {
      hypothesisDiv.innerHTML = text;
    }

    function OnSpeechEndDetected() {
      stopBtn.disabled = true;
    }

    function UpdateRecognizedPhrase(json) {
      phraseDiv.innerHTML = json;
    }

    function OnComplete() {
      startBtn.disabled = false;
      stopBtn.disabled = true;
    }

    document.addEventListener("DOMContentLoaded", function () {
      startBtn = document.getElementById("startBtn");
      stopBtn = document.getElementById("stopBtn");
      phraseDiv = document.getElementById("phraseDiv");
      hypothesisDiv = document.getElementById("hypothesisDiv");
      statusDiv = document.getElementById("statusDiv");
      key = 'INSERT_YOUR_KEY';
      //key = document.getElementById("key");
      languageOptions = 'fr-FR';
      //languageOptions = document.getElementById("languageOptions");

      formatOptions = 'Detailed';
      //formatOptions = document.getElementById("formatOptions");

      /*languageOptions.addEventListener("change", function () {
        Setup();
      });*/

      /*formatOptions.addEventListener("change", function () {
        Setup();
      });*/

      startBtn.addEventListener("click", function () {
        if (!recognizer || previousSubscriptionKey != key) {
          previousSubscriptionKey = key;
          Setup();
        }

        hypothesisDiv.innerHTML = "";
        phraseDiv.innerHTML = "";
        RecognizerStart(SDK, recognizer);
        startBtn.disabled = true;
        stopBtn.disabled = false;
      });

      stopBtn.addEventListener("click", function () {
        RecognizerStop(SDK);
        startBtn.disabled = false;
        stopBtn.disabled = true;
      });


    });
  </script>


</head>

<body>
    <div id="app"></div>
  <!-- built files will be auto injected -->
</body>

</html>