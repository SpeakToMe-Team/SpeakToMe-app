<% layout('../layout') %>

<div id="dashboard" class="dashboard-page">
    <nav class="container-fluid">
        <a href="/">
            <div class="logo animated bounceInLeft">
                <img src="/images/microphone.png" alt="logo">
                <p>{{ title }}</p>
            </div>
        </a>
        <div class="perso animated bounceInRight">        
            <div class="settings">
                <a href="#" data-toggle="modal" data-target="#myModal">
                    <i class="fa fa-cogs fa-spin"></i>
                </a>
            </div>
            <div class="myAccount">
                <a href="/profile">
                    <i class="fa fa-user"></i>
                </a>
            </div>
        </div>
    </nav>
    <section class="container">
        <div class="row">
            <div class="col-sm-12 col-md-8 col-lg-9">
                <article class="search col-sm-12 animated zoomInUp">
                    <i class="fa fa-microphone" aria-hidden="true"></i>
                    <input v-bind:value="phrase" type="text" name="request" placeholder="Dictez ou écrivez votre recherche ...">
                </article>

                <article class="result col-sm-12 animated zoomInUp">
                    <h2 class="title">Resultats</h2>

                    <div class="module">
                        <div class="spotify">
                            <iframe src="https://open.spotify.com/embed?uri=spotify:user:spotify:playlist:3rgsDhGHZxZ9sB9DQWQfuf" width="300" height="380" frameborder="0" allowtransparency="true"></iframe>
                        </div>
                    </div>

                    <div class="module">
                        <div class="spotify">
                            <form action="/profile" method="get">
                            <button id="test-button">test</button>
                            </form>
                        </div>
                    </div>
                </article>

                <article class="recommandation col-sm-12 animated zoomInUp">
                    <h2 class="title">Suggestions</h2>
                </article>
            </div>
            
            <div class="col-sm-12 col-md-4 col-lg-3">
                <article class="help col-md-12 animated zoomInUp">
                    <h2 class="title">Aide</h2>
                </article>
            </div>            
        </div>
    </section>

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Modal title</h4>
                </div>
                <div class="modal-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-primary">Valider</button>
                </div>
            </div>
        </div>
    </div>
    

</div>


<script>
    var dashboard = new Vue({
        el: "#dashboard",
        data: {
            title: "Dashboard",
            phrase: ''
        },
        methods: {
        }
    });
</script>

<script>
    if (annyang) {

        var show = function(tag) {
            console.log('tag de la recherche : ' + tag)
            var url = 'http://127.0.0.1.nip.io/api/speech?query='+tag;

            $.getJSON( "ajax/test.json", function( data ) {
                var items = [];
                let module = data.intent;

                switch(module) {
                    case 'weather':
                        console.log('module weather');
                        break;
                    case 'travel':
                        console.log("module travel");
                        break;
                    case 'movie':
                        console.log("movie");
                        break;                    
                    case 'music':
                        console.log("music");
                        break;           
                    default:
                        console.log("désolé je n'ai pas compris...");
                        break;
                }

                $.each( data, function( key, val ) {
                    console.log(key + ' => ' + val);
                    //items.push( "<li id='" + key + "'>" + val + "</li>" );
                });
            
                
            });
        }

        var activerModule = function(module) {
            console.log('activation : ' + module)
            // afficher avec Vue
        }

        var desactiverModule = function(module) {
            console.log('désactivation : ' + module)
            // cacher avec Vue
        }

        var commands = {
            'ouvrir panneau': function() {
                $('#myModal').modal('show');
            },
            'fermer panneau': function() {
                $('#myModal').modal('hide');
            },
            'voir profil': function() {
                window.location.href = "/profile";
            },
            'activer *module': activerModule,
            'désactiver *module': désactiverModule,
            
            'écouter musique': function() { // Ne marche pas
                //$('#play-button').click();
                console.log('lancer la musique');
                $('#test-button').trigger('submit');
                
            },
            // Pour toutes les recherches avec l'API : définir un mot clé 'ok google'...
            'ok google *tag': show
        }; 
        annyang.addCommands(commands);
        annyang.setLanguage('fr-FR');
        annyang.addCallback('result', function(phrases) {
            console.log("I think the user said: ", phrases[0]);
            dashboard.phrase = phrases[0];
            console.log("But then again, it could be any of the following: ", phrases);
        });        
        annyang.start();
    }
</script>
